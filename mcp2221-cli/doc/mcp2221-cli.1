.\" Automatically generated by Pandoc 3.7.0.2
.\"
.TH "mcp2221\-cli" "1" "" "2025\-06\-14 0.1.0"
.SH NAME
mcp2221\-cli \- interact with an MCP2221 USB to I2C and GPIO converter
.SH SYNOPSIS
.TP
\f[CR]mcp2221\-cli [OPTIONS] i2c COMMAND\f[R]
I2C communication
.TP
\f[CR]mcp2221\-cli [OPTIONS] pins COMMAND\f[R]
Pin configuration and GPIO operation
.TP
\f[CR]mcp2221\-cli [OPTIONS] adc COMMAND\f[R]
Analog input
.TP
\f[CR]mcp2221\-cli [OPTIONS] dac COMMAND\f[R]
Analog output
.TP
\f[CR]mcp2221\-cli [OPTIONS] settings <sram|flash>\f[R]
Read device settings
.TP
\f[CR]mcp2221\-cli [OPTIONS] status\f[R]
Read device status
.TP
\f[CR]mcp2221\-cli [OPTIONS] usb COMMAND\f[R]
Read USB information from the host and set device USB configuration
.TP
\f[CR]mcp2221\-cli [OPTIONS] reset\f[R]
Reset the MCP2221
.SH OPTIONS
.TP
\f[CR]\-v, \-\-vid\f[R]
USB vendor ID (VID) of the MCP2221, if it is not the default (0x4D8)
.TP
\f[CR]\-p, \-\-pid\f[R]
USB product ID (PID) of the MCP2221, if it is not the default (0xDD)
.SH COMMANDS
.SS I2C
Communicate on or configure the I2C bus.
Addresses and data bytes should be given in hexadecimal.
Read and write transfers must be at least 1 byte long and at most 65,535
bytes.
.TP
\f[CR]i2c read ADDRESS LENGTH\f[R]
Read LENGTH bytes from a target at ADDRESS
.TP
\f[CR]i2c write ADDRESS \-\- DATA...\f[R]
Write DATA bytes to the target at ADDRESS.
.RS
.PP
DATA must be at least 1 byte and at most 65,535 bytes, given in
hexadecimal and separated by a space.
.RE
.TP
\f[CR]i2c write\-read ADDRESS READ_LENGTH \-\- WRITE_DATA...\f[R]
Write WRITE_DATA bytes to the target at ADDRESS, issue a
repeated\-Start, and read READ_LENGTH bytes from the target.
No Stop is issued between the write and the read.
.TP
\f[CR]i2c check\-address ADDRESS\f[R]
Check if a target acknowledges ADDRESS by performing a zero\-length
write.
.TP
\f[CR]i2c speed KBPS\f[R]
Set the I2C bus speed to KBPS kbit/s.
KBPS should be a decimal integer between 47 and 400.
.TP
\f[CR]i2c cancel\f[R]
Cancel the current I2C transfer and attempt to free the bus.
.SS PINS
General purpose (GP) pin configuration, including digital (GPIO)
operation.
.TP
\f[CR]pins read\f[R]
Read the logic level and direction of the GP pins.
Only pins that are set to GPIO mode will show a value.
.TP
\f[CR]pins write [\-\-flash] <\-\-gp0 MODE | \-\-gp1 MODE | \-\-gp2 MODE | \-\-gp3 MODE>\f[R]
Change the direction and logic level of the GP pins.
Pins will only be affected if they are set to GPIO mode.
.RS
.TP
\f[CR]\-\-flash\f[R]
Change GPIO configuration in flash memory, affecting power\-up settings.
.RS
.PP
The behaviour of the GPIO pins will not be affected until the device is
reset.
.RE
.TP
\f[CR]MODE\f[R]
GPIO mode for the given GP pin.
.RS
.TP
\f[CR]output\-high\f[R]
Output a \f[I]high\f[R] logic level
.TP
\f[CR]output\-low\f[R]
Output a \f[I]low\f[R] logic level
.TP
\f[CR]input\f[R]
Set pin as an input
.RE
.RE
.TP
\f[CR]pins set\-mode [\-\-flash] <\-\-gp0 GP0 | \-\-gp1 GP1 | \-\-gp2 GP2 | \-\-gp3 GP3>\f[R]
Change the mode of the given GP pins, allowing the use of functions that
are specific to each pin.
All pins support the following GPIO modes, which are not repeated below:
.RS
.IP
.EX
gpio\-output\-high : GPIO mode, set to output a *high* logic level

gpio\-output\-low  : GPIO mode, set to output a *low* logic level

gpio\-input       : GPIO mode, set to input
.EE
.TP
\f[CR]\-\-flash\f[R]
Change pin configuration in flash memory, affecting power\-up settings.
.RS
.PP
The behaviour of the pins will not be affected until the device is
reset.
.RE
.TP
\f[CR]GP0\f[R]
Mode of pin GP0
.RS
.TP
\f[CR]uart\-receive\-led\f[R]
UART traffic received indicator (LED_URX), will pulse low for a few
milliseconds to provide a visual indication of the UART receive traffic
.TP
\f[CR]usb\-suspend\-state\f[R]
USB Suspend state (SSPND), low when the USB host has issued the Suspend
state, high after the Resume state is achieved
.RE
.TP
\f[CR]GP1\f[R]
Mode of pin GP1
.RS
.TP
\f[CR]clock\-output\f[R]
Digital clock output (CLK_OUT or CLKR)
.TP
\f[CR]analog\-input\f[R]
ADC channel 1
.TP
\f[CR]uart\-transmit\-led\f[R]
UART traffic transmitted indicator (LED_UTX), will pulse low for a few
milliseconds to provide a visual indication of the UART transmit traffic
.TP
\f[CR]interrupt\f[R]
Detects rising or falling edges and sets a flag in the chip status
.RE
.TP
\f[CR]GP2\f[R]
Mode of pin GP2
.RS
.TP
\f[CR]usb\-device\-configured\f[R]
USB device\-configured status (USBCFG), starts low after reset and goes
high once the device successfully configures to the USB
.TP
\f[CR]analog\-input\f[R]
ADC channel 2
.TP
\f[CR]analog\-output\f[R]
DAC output (single channel shared with GP3)
.RE
.TP
\f[CR]GP3\f[R]
Mode of pin GP3
.RS
.TP
\f[CR]i2c\-led\f[R]
Indicates I2C activity (LED_I2C), this pin will pulse low for a few
milliseconds to provide a visual indication of the I2C traffic
.TP
\f[CR]analog\-input\f[R]
ADC channel 3
.TP
\f[CR]analog\-output\f[R]
DAC output (single channel shared with GP2)
.RE
.RE
.SS ADC
Analog input commands.
.TP
\f[CR]adc read\f[R]
Get the current readings from the analog\-to\-digital converter.
Only pins that are configured as analog inputs will show a value.
.TP
\f[CR]adc configure [\-\-flash] REFERENCE [VRM_LEVEL]\f[R]
Set the voltage reference for the analog\-to\-digital converter.
.RS
.PP
The MCP2221\(cqs analog reference behaviour can be surprising (buggy).
See QUIRKS.
.TP
\f[CR]\-\-flash\f[R]
Change ADC configuration in flash memory, affecting power\-up settings.
.RS
.PP
The behaviour of the ADC will not be affected until the device is reset.
.RE
.TP
\f[CR]REFERENCE\f[R]
Voltage reference source for the ADC.
.RS
.TP
\f[CR]vdd\f[R]
Use the supply voltage as the voltage reference
.TP
\f[CR]vrm\f[R]
Use the internal voltage reference module
.RE
.TP
\f[CR][VRM_LEVEL]\f[R]
Voltage of the Vrm voltage reference, optional if REFERENCE is Vdd.
.RS
.TP
\f[CR]1v\f[R]
1.024V Vrm reference
.TP
\f[CR]2v\f[R]
2.048V Vrm reference
.TP
\f[CR]4v\f[R]
4.048V Vrm reference (only if Vdd is above 4V)
.TP
\f[CR]off\f[R]
Equivalent to setting REFERENCE to Vdd
.RE
.RE
.SS DAC
Analog output commands.
.TP
\f[CR]dac write VALUE\f[R]
Change the DAC output to VALUE, a 5\-bit integer (0 through 31).
.TP
\f[CR]dac configure [\-\-flash] REFERENCE [VRM_LEVEL]\f[R]
Set the voltage reference for the digital\-to\-analog converter.
.RS
.PP
The MCP2221\(cqs analog reference behaviour can be surprising (buggy).
See QUIRKS.
.TP
\f[CR]\-\-flash\f[R]
Change DAC configuration in flash memory, affecting power\-up settings.
.RS
.PP
The behaviour of the DAC will not be affected until the device is reset.
.RE
.TP
\f[CR]REFERENCE\f[R]
Voltage reference source for the DAC.
.RS
.TP
\f[CR]vdd\f[R]
Use the supply voltage as the voltage reference
.TP
\f[CR]vrm\f[R]
Use the internal voltage reference module
.RE
.TP
\f[CR][VRM_LEVEL]\f[R]
Voltage of the Vrm voltage reference, optional if REFERENCE is Vdd.
.RS
.TP
\f[CR]1v\f[R]
1.024V Vrm reference
.TP
\f[CR]2v\f[R]
2.048V Vrm reference
.TP
\f[CR]4v\f[R]G
4.048V Vrm reference (only if Vdd is above 4V)
.TP
\f[CR]off\f[R]
Equivalent to setting REFERENCE to Vdd
.RE
.RE
.SS SETTINGS
.TP
\f[CR]settings <sram|flash>\f[R]
Read the GP pin and chip settings from either SRAM or flash.
.RS
.PP
The SRAM settings determine the current behaviour of the MCP2221, while
the flash settings determine the initial behaviour of the device after
reset.
.PP
Note that the GP settings read from SRAM may not reflect the current
status of the GPIO pins.
See QUIRKS.
.RE
.SS STATUS
.TP
\f[CR]status\f[R]
.RS
.PP
Reads the current status of the MCP2221.
.RE
.RS
.PP
The structure is mostly I2C settings, along with the interrupt\-detected
flag, raw ADC values, and hardware and firmware revisin numbers.
.RE
.SS USB
.TP
\f[CR]info\f[R]
.RS
.PP
Read USB information from the host (from \f[CR]usbhid\f[R])
.RE
.TP
\f[CR]set manufacturer STRING\f[R]
Set the USB manufacturer descriptor to STRING, which must be fewer than
60 bytes when encoded as UTF\-16.
.TP
\f[CR]set product STRING\f[R]
Set the USB product descriptor to STRING, which must be fewer than 60
bytes when encoded as UTF\-16.
.TP
\f[CR]set serial STRING\f[R]
Set the USB serial number descriptor to STRING, which must be fewer than
60 bytes when encoded as UTF\-16.
.TP
\f[CR]set cdc\-enumeration <true|false>\f[R]
Set whether the USB serial number string will be presented during
enumeration of the CDC device (the USB serial converter).
If enabled, this will give the MCP2221 serial port a stable name.
.TP
\f[CR]set vid\f[R]
Set the USB vendor ID (VID).
.RS
.PP
If changed from the default, you must use the \f[CR]\-\-vid\f[R] option
with the CLI.
.RE
.TP
\f[CR]set pid\f[R]
Set the USB product ID (PID).
.RS
.PP
If changed from the default, you must use the \f[CR]\-\-pid\f[R] option
with the CLI.
.RE
.SS RESET
.TP
\f[CR]reset\f[R]
.RS
.PP
Reset the MCP2221.
.RE
.SH QUIRKS
The MCP2221, at least the MCP2221A rev A.6 with the 1.2 firmware, has
some surprising or buggy behaviour.
These behaviours are described in detail in the relevant sections of the
mcp2221\-hal documentation, but in summary:
.IP \(bu 2
Settings read from SRAM may not reflect the current status of pins in
GPIO mode.
It is also possible for the ADC and DAC Vrm levels to be set to
\(lqoff\(rq without this being reflected in the read SRAM settings
(though the bug that causes this cannot triggered by mcp2221\-cli or
mcp2221\-hal).
.IP \(bu 2
Setting the DAC reference to Vrm with a level of \(lqoff\(rq produces an
output of about 0V.
.IP \(bu 2
Setting either DAC or ADC voltage reference in flash to Vrm (at any
level) will lead to the relevant peripheral acting as if it was set to
Vrm with a level of \(lqoff\(rq.
.SH VERSION
0.1.0
.SH HOMEPAGE
.TP
https://github.com/robjwells/mcp2221\-hal
Source repository and bug tracker
.TP
https://docs.rs/mcp2221\-hal
Documentation of the underlying mcp2221\-hal crate
.PP
Please report bugs and feature requests to the bug tracker.
If the behaviour of the CLI is in any way unclear or confusing, please
also open an issue.
.SH AUTHORS
Rob Wells \c
.MT rob@robjwells.com
.ME \c
